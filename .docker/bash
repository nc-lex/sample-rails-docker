#!/usr/bin/env bash

ARG_HELP=
ARG_CONTAINER="app"
ARG_TIMEZONE=
ARG_ARGUMENTS=

IS_ARGUMENT=
while [[ $# > 0 ]]
do
  key="$1"
  if [[ -z "$IS_ARGUMENT" ]]; then
    case $key in
      -h|--help)
        ARG_HELP=YES
      ;;
      -t|--timezone)
        ARG_TIMEZONE="-t"
      ;;
      *)
        ARG_CONTAINER="$key"
        IS_ARGUMENT=YES
      ;;
    esac
  else
    ARG_ARGUMENTS="$ARG_ARGUMENTS $key"
  fi
  shift
done

if [[ -n "$ARG_HELP" ]]; then
  echo "Start an interactive console in the container"
  echo "Automatically starts the container if not running"
  echo "Usage:  $0 [OPTIONS] [CONTAINER [ARGUMENTS]]"
  echo "  -t, --timezone    Sync time zone with host machine (sudo required)"
  exit 0
fi

.docker/start -b -d $ARG_TIMEZONE $ARG_CONTAINER 2>&1 | grep -v "up-to-date"
docker-compose exec $ARG_CONTAINER /bin/bash $ARG_ARGUMENTS
